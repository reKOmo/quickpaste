import{s as H,a as z,_ as F}from"./I_QgPG2Y.js";import{g as K,r as g,s as q,h as $,i as U,j,k as V,l as A,m as Q,n as f,q as G,_ as J,v as L,x as W,y as B,z as E,A as X,c as w,B as Y,a as l,d as R,t as Z,b as ee,C as te,D as ae,E as se,F as oe,N as k,G as ne,o as y,p as re,f as ie,H as ce}from"./z7Z8vRUf.js";const le=s=>s==="defer"||s===!1;function M(...s){var m;const n=typeof s[s.length-1]=="string"?s.pop():void 0;typeof s[0]!="string"&&s.unshift(n);let[t,h,e={}]=s;if(typeof t!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof h!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const a=A(),I=h,u=()=>null,D=()=>a.isHydrating?a.payload.data[t]:a.static.data[t];e.server=e.server??!0,e.default=e.default??u,e.getCachedData=e.getCachedData??D,e.lazy=e.lazy??!1,e.immediate=e.immediate??!0,e.deep=e.deep??K.deep,e.dedupe=e.dedupe??"cancel";const x=()=>e.getCachedData(t,a)!=null;if(!a._asyncData[t]||!e.immediate){(m=a.payload._errors)[t]??(m[t]=null);const i=e.deep?g:q;a._asyncData[t]={data:i(e.getCachedData(t,a)??e.default()),pending:g(!x()),error:$(a.payload._errors,t),status:g("idle")}}const r={...a._asyncData[t]};r.refresh=r.execute=(i={})=>{if(a._asyncDataPromises[t]){if(le(i.dedupe??e.dedupe))return a._asyncDataPromises[t];a._asyncDataPromises[t].cancelled=!0}if((i._initial||a.isHydrating&&i._initial!==!1)&&x())return Promise.resolve(e.getCachedData(t,a));r.pending.value=!0,r.status.value="pending";const _=new Promise((o,c)=>{try{o(I(a))}catch(v){c(v)}}).then(async o=>{if(_.cancelled)return a._asyncDataPromises[t];let c=o;e.transform&&(c=await e.transform(o)),e.pick&&(c=ue(c,e.pick)),a.payload.data[t]=c,r.data.value=c,r.error.value=null,r.status.value="success"}).catch(o=>{if(_.cancelled)return a._asyncDataPromises[t];r.error.value=Q(o),r.data.value=f(e.default()),r.status.value="error"}).finally(()=>{_.cancelled||(r.pending.value=!1,delete a._asyncDataPromises[t])});return a._asyncDataPromises[t]=_,a._asyncDataPromises[t]},r.clear=()=>de(a,t);const d=()=>r.refresh({_initial:!0}),N=e.server!==!1&&a.payload.serverRendered;{const i=G();if(i&&!i._nuxtOnBeforeMountCbs){i._nuxtOnBeforeMountCbs=[];const o=i._nuxtOnBeforeMountCbs;i&&(U(()=>{o.forEach(c=>{c()}),o.splice(0,o.length)}),j(()=>o.splice(0,o.length)))}N&&a.isHydrating&&(r.error.value||x())?(r.pending.value=!1,r.status.value=r.error.value?"error":"success"):i&&(a.payload.serverRendered&&a.isHydrating||e.lazy)&&e.immediate?i._nuxtOnBeforeMountCbs.push(d):e.immediate&&d(),e.watch&&V(e.watch,()=>r.refresh());const _=a.hook("app:data:refresh",async o=>{(!o||o.includes(t))&&await r.refresh()});i&&j(_)}const b=Promise.resolve(a._asyncDataPromises[t]).then(()=>r);return Object.assign(b,r),b}function de(s,n){n in s.payload.data&&(s.payload.data[n]=void 0),n in s.payload._errors&&(s.payload._errors[n]=null),s._asyncData[n]&&(s._asyncData[n].data.value=void 0,s._asyncData[n].error.value=null,s._asyncData[n].pending.value=!1,s._asyncData[n].status.value="idle"),n in s._asyncDataPromises&&(s._asyncDataPromises[n].cancelled=!0,s._asyncDataPromises[n]=void 0)}function ue(s,n){const t={};for(const h of n)t[h]=s[h];return t}function fe(s){return{}}const O=s=>(re("data-v-1ee6c023"),s=s(),ie(),s),pe={key:0},he={key:1,class:"flex flex-row justify-center items-center mt-12"},me=["data"],_e={ref:"img0",src:H},ve=O(()=>l("div",{class:"bg-gradient-to-tr from-green to-orange rounded p-6 h-min hidden md:block"},[l("h2",{class:"text-2xl font-bold"},"Creating paste")],-1)),ye={key:2,class:"flex flex-row justify-center items-center mt-12"},ge=["data"],we={ref:"img1",src:z},xe={class:"doneText bg-gradient-to-tr from-green to-orange rounded p-6 h-min"},De=O(()=>l("h2",{class:"text-2xl font-bold"},"Paste created!",-1)),be=["href"],Pe={key:1},Ie={key:0,class:"flex flex-col items-center space-y-4"},Ne=O(()=>l("h2",{class:"text-xl text-gray-300"},"Enter password to view the paste",-1)),Ce={class:"flex flex-col md:flex-row space-y-2 md:space-y-0"},ke={key:1},Oe=O(()=>l("div",{class:"flex flex-col justify-center content-center text-center bg-gradient-to-tr from-green to-orange mb-4 p-4 rounded"},[l("h1",{class:"text-3xl text-white text-shadow-sm"}," No paste here ")],-1)),Te=[Oe],Ee={__name:"[pasteId]",async setup(s){let n,t;const h=L(),e=W();let{data:a,error:I}=([n,t]=B(async()=>M("paste",async o=>{const v=E().params.pasteId,p=fe().cookie,P={};if(p)return p.split(";").forEach(C=>{const S=C.split("=");P[S[0].trim()]=S[1]}),await $fetch(`${ce().public.webAddress}/api/paste/${v}`,{headers:{Authorization:"ApiKey "+P.quickpaste_auth},parseResponse:JSON.parse})},{server:!0})),n=await n,t(),n),u=g(a);u.value;let{data:D}=([n,t]=B(()=>M("error",()=>I.value?I.value.response.status:200,{server:!0})),n=await n,t(),n),x=g(!1);const r=E();let d=g("");function N(){if(h.user()==null||u.value==null||u.value.owner.id!=h.id())return;E().query.edit&&(x.value=!0)}async function b(){if(d.value.length===0){e.addNotification({type:1,title:"Please enter password to view",level:1});return}const o=await fetch(`/api/paste/${r.params.pasteId}`,{method:"GET",headers:{"Paste-Authorization":d.value},credentials:"include"});if(o.ok)u.value=await o.json(),D=0,d.value.length!=0&&(u.value.password=d.value),N(),document.title="Quickpaste | "+u.value.title.substring(0,25);else{switch(o.status){case 401:e.addNotification({type:1,title:"Incorrect password",level:1});break}d.value="",D=o.status}}let m=g(0),i=g(void 0);const _=async o=>{m.value=1,u.value=o;const c={"Content-Type":"application/json"};d.value.length!=0&&(c["Paste-Authorization"]=d.value);const v=await fetch(`/api/paste/${r.params.pasteId}`,{method:"PUT",headers:c,credentials:"include",body:JSON.stringify(o)}),p=await v.json();v.ok?(m.value=2,i.value=p.result):(m.value=0,p.result.includes("title")?e.addNotification({title:"Paste title is missing",type:k.NOTIFICATION,level:1}):p.result.includes("name")?e.addNotification({title:"One or more fragments are missing a title",type:k.NOTIFICATION,level:1}):p.result.includes("content")?e.addNotification({title:"One or more fragments are missing content",description:"Please deleate them, or add missing content",type:k.NOTIFICATION,level:1}):e.addNotification({title:"Error accured when creating the paste",description:"Please try again.",type:k.NOTIFICATION,level:1}))};return u.value&&(document.title="Quickpaste | "+u.value.title.substring(0,25)),X(()=>{N()}),(o,c)=>{var P,T;const v=F,p=ne("font-awesome-icon");return y(),w("div",null,[f(u)?(y(),w("div",pe,[f(m)==0?(y(),Y(v,{key:0,onSubmit:_,paste:f(u),editable:f(x),submitText:"Re-Paste !"},null,8,["paste","editable"])):f(m)==1?(y(),w("div",he,[l("object",{width:"300",height:"300",type:"image/svg+xml",data:f(H)},[l("img",_e,null,512)],8,me),ve])):(y(),w("div",ye,[l("object",{class:"w-100px sm:w-150px md:w-300px",type:"image/svg+xml",data:f(z)},[l("img",we,null,512)],8,ge),l("div",xe,[De,l("h3",null,[R(" Check it at: "),l("a",{class:"font-bold",href:`/${(P=f(i))==null?void 0:P.pasteId}`},[R(Z((T=f(i))==null?void 0:T.pasteId)+" ",1),ee(p,{icon:["fas","arrow-up-right-from-square"]})],8,be)])])]))])):(y(),w("div",Pe,[f(D)==401?(y(),w("div",Ie,[Ne,l("div",Ce,[te(l("input",{onKeyup:se(b,["enter"]),"onUpdate:modelValue":c[0]||(c[0]=C=>oe(d)?d.value=C:d=C),type:"password",autocomplete:"off",class:"p-2 w-full md:w-auto text-center text-white rounded border-none focus:outline-none text-lg text-bold bg-darkgray mr-4"},null,544),[[ae,f(d)]]),l("button",{onClick:b,class:"bg-gradient-to-tr from-green to-orange rounded p-2 text-center hover:shadow-lg"},"Enter")])])):(y(),w("div",ke,Te))]))])}}},Re=J(Ee,[["__scopeId","data-v-1ee6c023"]]);export{Re as default};
