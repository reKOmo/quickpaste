import{s as M,a as R,_ as V}from"./hJSzFLvQ.js";import{y as K,z as D,r as g,A as z,B as H,C as q,D as F,E as $,G as U,H as E,I as Q,J as G,i as f,_ as J,f as A,g as L,K as S,n as k,h as W,c as _,q as X,a as d,d as B,b as Y,t as Z,L as ee,M as te,O as ae,Q as se,m as re,k as ne,o as v,N as T}from"./Dp9ICUzo.js";const oe=r=>r==="defer"||r===!1;function j(...r){var N;const o=typeof r[r.length-1]=="string"?r.pop():void 0;typeof r[0]!="string"&&r.unshift(o);let[a,m,e={}]=r;if(typeof a!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof m!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const t=K(),C=m,x=()=>D.value,I=()=>t.isHydrating?t.payload.data[a]:t.static.data[a];e.server??(e.server=!0),e.default??(e.default=x),e.getCachedData??(e.getCachedData=I),e.lazy??(e.lazy=!1),e.immediate??(e.immediate=!0),e.deep??(e.deep=D.deep),e.dedupe??(e.dedupe="cancel");const y=e.getCachedData(a,t),u=y!=null;if(!t._asyncData[a]||!e.immediate){(N=t.payload._errors)[a]??(N[a]=D.errorValue);const n=e.deep?g:z;t._asyncData[a]={data:n(u?y:e.default()),pending:g(!u),error:H(t.payload._errors,a),status:g("idle"),_default:e.default}}const i={...t._asyncData[a]};delete i._default,i.refresh=i.execute=(n={})=>{if(t._asyncDataPromises[a]){if(oe(n.dedupe??e.dedupe))return t._asyncDataPromises[a];t._asyncDataPromises[a].cancelled=!0}if(n._initial||t.isHydrating&&n._initial!==!1){const c=n._initial?y:e.getCachedData(a,t);if(c!=null)return Promise.resolve(c)}i.pending.value=!0,i.status.value="pending";const l=new Promise((c,s)=>{try{c(C(t))}catch(h){s(h)}}).then(async c=>{if(l.cancelled)return t._asyncDataPromises[a];let s=c;e.transform&&(s=await e.transform(c)),e.pick&&(s=le(s,e.pick)),t.payload.data[a]=s,i.data.value=s,i.error.value=D.errorValue,i.status.value="success"}).catch(c=>{if(l.cancelled)return t._asyncDataPromises[a];i.error.value=G(c),i.data.value=f(e.default()),i.status.value="error"}).finally(()=>{l.cancelled||(i.pending.value=!1,delete t._asyncDataPromises[a])});return t._asyncDataPromises[a]=l,t._asyncDataPromises[a]},i.clear=()=>ie(t,a);const b=()=>i.refresh({_initial:!0}),p=e.server!==!1&&t.payload.serverRendered;{const n=q();if(n&&p&&e.immediate&&!n.sp&&(n.sp=[]),n&&!n._nuxtOnBeforeMountCbs){n._nuxtOnBeforeMountCbs=[];const s=n._nuxtOnBeforeMountCbs;F(()=>{s.forEach(h=>{h()}),s.splice(0,s.length)}),$(()=>s.splice(0,s.length))}p&&t.isHydrating&&(i.error.value||y!=null)?(i.pending.value=!1,i.status.value=i.error.value?"error":"success"):n&&(t.payload.serverRendered&&t.isHydrating||e.lazy)&&e.immediate?n._nuxtOnBeforeMountCbs.push(b):e.immediate&&b();const l=Q();if(e.watch){const s=U(e.watch,()=>i.refresh());l&&E(s)}const c=t.hook("app:data:refresh",async s=>{(!s||s.includes(a))&&await i.refresh()});l&&E(c)}const w=Promise.resolve(t._asyncDataPromises[a]).then(()=>i);return Object.assign(w,i),w}function ie(r,o){o in r.payload.data&&(r.payload.data[o]=void 0),o in r.payload._errors&&(r.payload._errors[o]=D.errorValue),r._asyncData[o]&&(r._asyncData[o].data.value=void 0,r._asyncData[o].error.value=D.errorValue,r._asyncData[o].pending.value=!1,r._asyncData[o].status.value="idle"),o in r._asyncDataPromises&&(r._asyncDataPromises[o]&&(r._asyncDataPromises[o].cancelled=!0),r._asyncDataPromises[o]=void 0)}function le(r,o){const a={};for(const m of o)a[m]=r[m];return a}function ce(r){return{}}const de={key:0},ue={key:1,class:"flex flex-row justify-center items-center mt-12"},fe=["data"],me={ref:"img0",src:M},pe={key:2,class:"flex flex-row justify-center items-center mt-12"},ve=["data"],ye={ref:"img1",src:R},he={class:"doneText bg-gradient-to-tr from-green to-orange rounded p-6 h-min"},_e=["href"],ge={key:1},we={key:0,class:"flex flex-col items-center space-y-4"},De={class:"flex flex-col md:flex-row space-y-2 md:space-y-0"},xe={key:1},be={__name:"[pasteId]",async setup(r){let o,a;const m=A(),e=L();let{data:t,error:C}=([o,a]=S(async()=>j("paste",async()=>{const l=k().params.pasteId,c=ce().cookie,s={};return c&&c.split(";").forEach(O=>{const P=O.split("=");s[P[0].trim()]=P[1]}),await $fetch(`${re().public.webAddress}/api/paste/${l}`,{headers:{authorization:"ApiKey "+s.quickpaste_auth}})},{server:!0})),o=await o,a(),o);t.value;let{data:x}=([o,a]=S(()=>j("error",()=>!t.value&&C.value?C.value.statusCode:200,{server:!0})),o=await o,a(),o),I=g(!1);const y=k();let u=g("");function i(){if(m.user()==null||t.value==null||t.value.owner.id!=m.id())return;k().query.edit&&(I.value=!0)}async function b(){if(u.value.length===0){e.addNotification({type:1,title:"Please enter password to view",level:1});return}const n=await fetch(`/api/paste/${y.params.pasteId}`,{method:"GET",headers:{"Paste-Authorization":u.value},credentials:"include"});if(n.ok)t.value=await n.json(),x=0,u.value.length!=0&&(t.value.password=u.value),i(),document.title="Quickpaste | "+t.value.title.substring(0,25);else{switch(n.status){case 401:e.addNotification({type:1,title:"Incorrect password",level:1});break}u.value="",x=n.status}}let p=g(0),w=g(void 0);const N=async n=>{p.value=1,t.value=n;const l={"Content-Type":"application/json"};u.value.length!=0&&(l["Paste-Authorization"]=u.value);const c=await fetch(`/api/paste/${y.params.pasteId}`,{method:"PUT",headers:l,credentials:"include",body:JSON.stringify(n)}),s=await c.json();c.ok?(p.value=2,w.value=s.result):(p.value=0,s.result.includes("title")?e.addNotification({title:"Paste title is missing",type:T.NOTIFICATION,level:1}):s.result.includes("name")?e.addNotification({title:"One or more fragments are missing a title",type:T.NOTIFICATION,level:1}):s.result.includes("content")?e.addNotification({title:"One or more fragments are missing content",description:"Please deleate them, or add missing content",type:T.NOTIFICATION,level:1}):e.addNotification({title:"Error accured when creating the paste",description:"Please try again.",type:T.NOTIFICATION,level:1}))};return t.value&&(document.title="Quickpaste | "+t.value.title.substring(0,25)),W(()=>{i()}),(n,l)=>{var h,O;const c=V,s=ne("font-awesome-icon");return v(),_("div",null,[f(t)?(v(),_("div",de,[f(p)==0?(v(),X(c,{key:0,onSubmit:N,paste:f(t),editable:f(I),submitText:"Re-Paste !"},null,8,["paste","editable"])):f(p)==1?(v(),_("div",ue,[d("object",{width:"300",height:"300",type:"image/svg+xml",data:f(M)},[d("img",me,null,512)],8,fe),l[1]||(l[1]=d("div",{class:"bg-gradient-to-tr from-green to-orange rounded p-6 h-min hidden md:block"},[d("h2",{class:"text-2xl font-bold"},"Creating paste")],-1))])):(v(),_("div",pe,[d("object",{class:"w-100px sm:w-150px md:w-300px",type:"image/svg+xml",data:f(R)},[d("img",ye,null,512)],8,ve),d("div",he,[l[3]||(l[3]=d("h2",{class:"text-2xl font-bold"},"Paste created!",-1)),d("h3",null,[l[2]||(l[2]=B(" Check it at: ")),d("a",{class:"font-bold",href:`/paste/${(h=f(w))==null?void 0:h.pasteId}`},[B(Z((O=f(w))==null?void 0:O.pasteId)+" ",1),Y(s,{icon:["fas","arrow-up-right-from-square"]})],8,_e)])])]))])):(v(),_("div",ge,[f(x)==401?(v(),_("div",we,[l[4]||(l[4]=d("h2",{class:"text-xl text-gray-300"},"Enter password to view the paste",-1)),d("div",De,[ee(d("input",{onKeyup:ae(b,["enter"]),"onUpdate:modelValue":l[0]||(l[0]=P=>se(u)?u.value=P:u=P),type:"password",autocomplete:"off",class:"p-2 w-full md:w-auto text-center text-white rounded border-none focus:outline-none text-lg text-bold bg-darkgray mr-4"},null,544),[[te,f(u)]]),d("button",{onClick:b,class:"bg-gradient-to-tr from-green to-orange rounded p-2 text-center hover:shadow-lg"},"Enter")])])):(v(),_("div",xe,l[5]||(l[5]=[d("div",{class:"flex flex-col justify-center content-center text-center bg-gradient-to-tr from-green to-orange mb-4 p-4 rounded"},[d("h1",{class:"text-3xl text-white text-shadow-sm"}," No paste here ")],-1)])))]))])}}},Ie=J(be,[["__scopeId","data-v-5ea59b0b"]]);export{Ie as default};
