import{s as M,a as R,_ as H}from"./D6s1QMic.js";import{v as z,k as v,x as K,y as q,z as F,A as E,B as $,C as U,D as V,h as u,E as Q,_ as A,i as G,j as J,G as S,s as T,l as L,c as _,H as W,a as d,d as j,t as X,b as Y,I as Z,J as ee,K as te,L as ae,N,n as se,o as m,p as oe,f as ne,q as re}from"./DhotaUmr.js";const ie=o=>o==="defer"||o===!1;function B(...o){var g;const n=typeof o[o.length-1]=="string"?o.pop():void 0;typeof o[0]!="string"&&o.unshift(n);let[a,p,t={}]=o;if(typeof a!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof p!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");const e=U(),b=p,w=()=>null,P=()=>e.isHydrating?e.payload.data[a]:e.static.data[a];t.server=t.server??!0,t.default=t.default??w,t.getCachedData=t.getCachedData??P,t.lazy=t.lazy??!1,t.immediate=t.immediate??!0,t.deep=t.deep??z.deep,t.dedupe=t.dedupe??"cancel";const y=()=>t.getCachedData(a,e)!=null;if(!e._asyncData[a]||!t.immediate){(g=e.payload._errors)[a]??(g[a]=null);const c=t.deep?v:K;e._asyncData[a]={data:c(t.getCachedData(a,e)??t.default()),pending:v(!y()),error:q(e.payload._errors,a),status:v("idle")}}const s={...e._asyncData[a]};s.refresh=s.execute=(c={})=>{if(e._asyncDataPromises[a]){if(ie(c.dedupe??t.dedupe))return e._asyncDataPromises[a];e._asyncDataPromises[a].cancelled=!0}if((c._initial||e.isHydrating&&c._initial!==!1)&&y())return Promise.resolve(t.getCachedData(a,e));s.pending.value=!0,s.status.value="pending";const i=new Promise((r,l)=>{try{r(b(e))}catch(f){l(f)}}).then(async r=>{if(i.cancelled)return e._asyncDataPromises[a];let l=r;t.transform&&(l=await t.transform(r)),t.pick&&(l=ce(l,t.pick)),e.payload.data[a]=l,s.data.value=l,s.error.value=null,s.status.value="success"}).catch(r=>{if(i.cancelled)return e._asyncDataPromises[a];s.error.value=V(r),s.data.value=u(t.default()),s.status.value="error"}).finally(()=>{i.cancelled||(s.pending.value=!1,delete e._asyncDataPromises[a])});return e._asyncDataPromises[a]=i,e._asyncDataPromises[a]},s.clear=()=>le(e,a);const x=()=>s.refresh({_initial:!0}),I=t.server!==!1&&e.payload.serverRendered;{const c=Q();if(c&&!c._nuxtOnBeforeMountCbs){c._nuxtOnBeforeMountCbs=[];const r=c._nuxtOnBeforeMountCbs;c&&(F(()=>{r.forEach(l=>{l()}),r.splice(0,r.length)}),E(()=>r.splice(0,r.length)))}I&&e.isHydrating&&(s.error.value||y())?(s.pending.value=!1,s.status.value=s.error.value?"error":"success"):c&&(e.payload.serverRendered&&e.isHydrating||t.lazy)&&t.immediate?c._nuxtOnBeforeMountCbs.push(x):t.immediate&&x(),t.watch&&$(t.watch,()=>s.refresh());const i=e.hook("app:data:refresh",async r=>{(!r||r.includes(a))&&await s.refresh()});c&&E(i)}const h=Promise.resolve(e._asyncDataPromises[a]).then(()=>s);return Object.assign(h,s),h}function le(o,n){n in o.payload.data&&(o.payload.data[n]=void 0),n in o.payload._errors&&(o.payload._errors[n]=null),o._asyncData[n]&&(o._asyncData[n].data.value=void 0,o._asyncData[n].error.value=null,o._asyncData[n].pending.value=!1,o._asyncData[n].status.value="idle"),n in o._asyncDataPromises&&(o._asyncDataPromises[n].cancelled=!0,o._asyncDataPromises[n]=void 0)}function ce(o,n){const a={};for(const p of n)a[p]=o[p];return a}function de(o){return{}}const k=o=>(oe("data-v-5ea59b0b"),o=o(),ne(),o),ue={key:0},fe={key:1,class:"flex flex-row justify-center items-center mt-12"},pe=["data"],he={ref:"img0",src:M},me=k(()=>d("div",{class:"bg-gradient-to-tr from-green to-orange rounded p-6 h-min hidden md:block"},[d("h2",{class:"text-2xl font-bold"},"Creating paste")],-1)),_e={key:2,class:"flex flex-row justify-center items-center mt-12"},ve=["data"],ye={ref:"img1",src:R},ge={class:"doneText bg-gradient-to-tr from-green to-orange rounded p-6 h-min"},we=k(()=>d("h2",{class:"text-2xl font-bold"},"Paste created!",-1)),xe=["href"],De={key:1},be={key:0,class:"flex flex-col items-center space-y-4"},Pe=k(()=>d("h2",{class:"text-xl text-gray-300"},"Enter password to view the paste",-1)),Ie={class:"flex flex-col md:flex-row space-y-2 md:space-y-0"},Ce={key:1},Ne=k(()=>d("div",{class:"flex flex-col justify-center content-center text-center bg-gradient-to-tr from-green to-orange mb-4 p-4 rounded"},[d("h1",{class:"text-3xl text-white text-shadow-sm"}," No paste here ")],-1)),ke=[Ne],Oe={__name:"[pasteId]",async setup(o){let n,a;const p=G(),t=J();let{data:e,error:b}=([n,a]=S(async()=>B("paste",async()=>{const r=T().params.pasteId,l=de().cookie,f={};return l&&l.split(";").forEach(C=>{const D=C.split("=");f[D[0].trim()]=D[1]}),await $fetch(`${re().public.webAddress}/api/paste/${r}`,{headers:{authorization:"ApiKey "+f.quickpaste_auth}})},{server:!0})),n=await n,a(),n);e.value;let{data:w}=([n,a]=S(()=>B("error",()=>!e.value&&b.value?b.value.statusCode:200,{server:!0})),n=await n,a(),n),P=v(!1);const y=T();let s=v("");function x(){if(p.user()==null||e.value==null||e.value.owner.id!=p.id())return;T().query.edit&&(P.value=!0)}async function I(){if(s.value.length===0){t.addNotification({type:1,title:"Please enter password to view",level:1});return}const i=await fetch(`/api/paste/${y.params.pasteId}`,{method:"GET",headers:{"Paste-Authorization":s.value},credentials:"include"});if(i.ok)e.value=await i.json(),w=0,s.value.length!=0&&(e.value.password=s.value),x(),document.title="Quickpaste | "+e.value.title.substring(0,25);else{switch(i.status){case 401:t.addNotification({type:1,title:"Incorrect password",level:1});break}s.value="",w=i.status}}let h=v(0),g=v(void 0);const c=async i=>{h.value=1,e.value=i;const r={"Content-Type":"application/json"};s.value.length!=0&&(r["Paste-Authorization"]=s.value);const l=await fetch(`/api/paste/${y.params.pasteId}`,{method:"PUT",headers:r,credentials:"include",body:JSON.stringify(i)}),f=await l.json();l.ok?(h.value=2,g.value=f.result):(h.value=0,f.result.includes("title")?t.addNotification({title:"Paste title is missing",type:N.NOTIFICATION,level:1}):f.result.includes("name")?t.addNotification({title:"One or more fragments are missing a title",type:N.NOTIFICATION,level:1}):f.result.includes("content")?t.addNotification({title:"One or more fragments are missing content",description:"Please deleate them, or add missing content",type:N.NOTIFICATION,level:1}):t.addNotification({title:"Error accured when creating the paste",description:"Please try again.",type:N.NOTIFICATION,level:1}))};return e.value&&(document.title="Quickpaste | "+e.value.title.substring(0,25)),L(()=>{x()}),(i,r)=>{var O,C;const l=H,f=se("font-awesome-icon");return m(),_("div",null,[u(e)?(m(),_("div",ue,[u(h)==0?(m(),W(l,{key:0,onSubmit:c,paste:u(e),editable:u(P),submitText:"Re-Paste !"},null,8,["paste","editable"])):u(h)==1?(m(),_("div",fe,[d("object",{width:"300",height:"300",type:"image/svg+xml",data:u(M)},[d("img",he,null,512)],8,pe),me])):(m(),_("div",_e,[d("object",{class:"w-100px sm:w-150px md:w-300px",type:"image/svg+xml",data:u(R)},[d("img",ye,null,512)],8,ve),d("div",ge,[we,d("h3",null,[j(" Check it at: "),d("a",{class:"font-bold",href:`/paste/${(O=u(g))==null?void 0:O.pasteId}`},[j(X((C=u(g))==null?void 0:C.pasteId)+" ",1),Y(f,{icon:["fas","arrow-up-right-from-square"]})],8,xe)])])]))])):(m(),_("div",De,[u(w)==401?(m(),_("div",be,[Pe,d("div",Ie,[Z(d("input",{onKeyup:te(I,["enter"]),"onUpdate:modelValue":r[0]||(r[0]=D=>ae(s)?s.value=D:s=D),type:"password",autocomplete:"off",class:"p-2 w-full md:w-auto text-center text-white rounded border-none focus:outline-none text-lg text-bold bg-darkgray mr-4"},null,544),[[ee,u(s)]]),d("button",{onClick:I,class:"bg-gradient-to-tr from-green to-orange rounded p-2 text-center hover:shadow-lg"},"Enter")])])):(m(),_("div",Ce,ke))]))])}}},je=A(Oe,[["__scopeId","data-v-5ea59b0b"]]);export{je as default};
